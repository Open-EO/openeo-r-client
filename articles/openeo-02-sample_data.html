<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample Data Retrieval • openeo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sample Data Retrieval">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openeo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/openeo-01-getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/openeo-02-sample_data.html">Sample Data Retrieval</a>
    </li>
    <li>
      <a href="../articles/openeo-03-package-software-architecture.html">Software and Package Architecture</a>
    </li>
    <li>
      <a href="../articles/openeo-04-process_graph_concepts.html">Process Graph Building</a>
    </li>
    <li>
      <a href="../articles/openeo-05-process_graph_building_application.html">Process Graph Building Application</a>
    </li>
    <li>
      <a href="../articles/openeo-06-developer_implementation_details.html">Developer Implementation Details</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Open-EO/openeo-r-client/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sample Data Retrieval</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Open-EO/openeo-r-client/blob/master/vignettes/openeo-02-sample_data.Rmd" class="external-link"><code>vignettes/openeo-02-sample_data.Rmd</code></a></small>
      <div class="hidden name"><code>openeo-02-sample_data.Rmd</code></div>

    </div>

    
    
<p>During this examples, we will use <em>openEO Platform</em> as
back-end implementation. Also the <em>openEO Platform</em> as a project
is under continuous development and the assumptions for receiving sample
data made in this project, had to consider the current state of the
back-end implementations. In the following course of this vignette, we
will give some examples, how to obtain sample data for developing and
debugging your openEO workflows. The example code is printed, but the
results for many code blocks will not be shown. This has to be this way,
because there are interactive elements involved like authenticating with
personal user credentials against the back-end service.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>For dealing with remote processing trust is one very important
aspect. For once you must trust the provider that the data is correctly
pre-processed, meaning the data collection is correct and valid. Then
the provided operators like mathematical band operations or kernel
operations need to work correctly. Also you must trust that the
optimization and parallelization strategy work correctly and do not
affect the quality of your analysis. One way to build trust towards a
remote processing system is testing through local inspection of data.
The other aspects in remote processing for the need of sample data with
regard to <em>openEO</em> is debugging and the development of user
defined functions (UDF).</p>
<p>As for now, openEO Platform supports the user on this matter in the
form that data can be processed until a specific processing step and the
result can be downloaded.</p>
<p>In order to minimize the effort for an R user to obtain a small data
chunk as sample data for local inspection, the function
<code><a href="../reference/get_sample.html">get_sample()</a></code> was developed. As <em>openEO</em> normally
operates on spatio-temporal data cubes, the <code><a href="../reference/get_sample.html">get_sample()</a></code>
function aims to reduce the amount of data by sub setting the initial
data spatially. Furthermore by using this function you already download
the sample data and retrieve it optionally as a <code>stars</code>
object. The latter will require the package <code>stars</code> to be
installed in your R environment.</p>
</div>
<div class="section level2">
<h2 id="connecting">Connecting<a class="anchor" aria-label="anchor" href="#connecting"></a>
</h2>
<p>At first, we need an enabled account at openEO platform, then we
establish a connection to the back-end and start the login procedure. In
the process you will be asked for your authentication provider and
potentially your login credentials (e.g. Authentication with Github,
where you will be redirected to the Github page). During the process you
will be very likely asked for a device code, which will be printed to
console during the authentication procedure. This code needs to be
copied and pasted into the respective field in the internet browser. You
will then need to authorize the connection of ‘openeo’ for this session,
which you will be asked also in the browser window.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">=</span> <span class="fu"><a href="../reference/connect.html">connect</a></span><span class="op">(</span><span class="st">"https://openeo.cloud"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/login.html">login</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-case">Use Case<a class="anchor" aria-label="anchor" href="#use-case"></a>
</h2>
<p>As an example use case we will calculate the NDVI for a certain
temporal interval. To make comparison easier at the end, the original
bounding box is stored as a separate variable <code>bounding_box</code>.
Potentially the steps afterwards could be a spatial aggregation
operation on polygons and calculating zonal statistics, but this will
not be covered in this example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/processes.html">processes</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">coll</span> <span class="op">=</span> <span class="fu"><a href="../reference/list_collections.html">list_collections</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="../reference/list_file_formats.html">list_file_formats</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bounding_box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>west<span class="op">=</span><span class="fl">6.75</span>,south<span class="op">=</span><span class="fl">51.85</span>,east<span class="op">=</span><span class="fl">7.25</span>,north<span class="op">=</span><span class="fl">52.15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">load_collection</span><span class="op">(</span>id <span class="op">=</span> <span class="va">coll</span><span class="op">$</span><span class="va">SENTINEL2_L2A</span>,</span>
<span>                         bands<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B04"</span>,<span class="st">"B08"</span><span class="op">)</span>,</span>
<span>                         spatial_extent <span class="op">=</span> <span class="va">bounding_box</span>,</span>
<span>                         temporal_extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"2021-03-01"</span>,<span class="st">"2021-07-15"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ndvi</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">reduce_dimension</span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, dimension <span class="op">=</span> <span class="st">"bands"</span>,reducer <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">context</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">b04</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">b08</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">(</span><span class="va">b08</span><span class="op">-</span><span class="va">b04</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">b08</span><span class="op">+</span><span class="va">b04</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="excursion-sample-data-retrieval-without-get_sample-function">Excursion: Sample Data Retrieval without <code>get_sample()</code>
function<a class="anchor" aria-label="anchor" href="#excursion-sample-data-retrieval-without-get_sample-function"></a>
</h2>
<p>Without the sampling function you need to configure the workflow
completely by yourself, which involves:</p>
<ol style="list-style-type: decimal">
<li>create a small subset like a bounding box</li>
<li>exchange the occuring bounding boxes with this new one</li>
<li>Also before the changes to <code>compute_result</code> you would
have to manually set the <code>save_result</code> node.</li>
<li>send the workflow to the back-end</li>
<li>store the results into a file</li>
<li>load the file with <code>stars</code> or any other package that can
handle spatial or spatio-temporal data</li>
</ol>
<p>A workflow would have looked like the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">save_result</span><span class="op">(</span><span class="va">ndvi</span>, format <span class="op">=</span> <span class="va">f</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">netCDF</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as</span><span class="op">(</span><span class="va">res</span>,<span class="st">"Process"</span><span class="op">)</span></span></code></pre></div>
<p>Calculate a new bounding box.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">center</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bounding_box</span><span class="op">$</span><span class="va">west</span>, <span class="va">bounding_box</span><span class="op">$</span><span class="va">east</span><span class="op">)</span><span class="op">)</span>, lat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bounding_box</span><span class="op">$</span><span class="va">south</span>, <span class="va">bounding_box</span><span class="op">$</span><span class="va">north</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diff</span> <span class="op">=</span> <span class="fl">0.0003</span></span>
<span><span class="va">sample_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>west<span class="op">=</span><span class="va">center</span><span class="op">$</span><span class="va">lon</span><span class="op">-</span><span class="va">diff</span>,south<span class="op">=</span><span class="va">center</span><span class="op">$</span><span class="va">lat</span><span class="op">-</span><span class="va">diff</span>,east<span class="op">=</span><span class="va">center</span><span class="op">$</span><span class="va">lon</span><span class="op">+</span><span class="va">diff</span>,north<span class="op">=</span><span class="va">center</span><span class="op">$</span><span class="va">lat</span><span class="op">+</span><span class="va">diff</span><span class="op">)</span></span></code></pre></div>
<p>Replace the old bounding box with the new one.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">spatial_extent</span> <span class="op">=</span> <span class="va">sample_bbox</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span></code></pre></div>
<p>Compute the results and store them in a file on your local disk.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manual_file</span> <span class="op">=</span> <span class="st">"test_manual.nc"</span></span>
<span><span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="../reference/compute_result.html">compute_result</a></span><span class="op">(</span><span class="va">res</span>,output_file <span class="op">=</span> <span class="va">manual_file</span><span class="op">)</span></span></code></pre></div>
<p>Check the data by opening the file with <code>stars</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="va">manual_file</span>,driver <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">detect.driver</a></span><span class="op">(</span><span class="va">manual_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj</span></span></code></pre></div>
<p>Update the time dimension with a more useful representation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_get_dimension_values</a></span><span class="op">(</span><span class="va">obj</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_set_dimensions</a></span><span class="op">(</span><span class="va">obj</span>,which<span class="op">=</span><span class="st">"t"</span>,values <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">obj</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html" class="external-link">geom_stars</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">obj</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">spatial_extent</span> <span class="op">=</span> <span class="va">bounding_box</span></span>
<span><span class="va">data</span></span></code></pre></div>
<p>Running sample data retrieval this way is still valid and reasonable,
when more complex spatial features are used for spatial sub setting.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bounding_box</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">initial_bbox</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xmin"</span>,<span class="st">"ymin"</span>,<span class="st">"xmax"</span>,<span class="st">"ymax"</span><span class="op">)</span></span>
<span><span class="va">sample_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sample_bbox</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sample_bbox</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xmin"</span>,<span class="st">"ymin"</span>,<span class="st">"xmax"</span>,<span class="st">"ymax"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">initial_bbox</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sample_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">sample_bbox</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">received_data_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapview</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">initial_bbox</span>,<span class="va">sample_bbox</span>,<span class="va">received_data_bbox</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sample-data-support">Sample Data Support<a class="anchor" aria-label="anchor" href="#sample-data-support"></a>
</h2>
<p>The two driving functions for sample retrieval are
<code><a href="../reference/get_sample.html">get_sample()</a></code> in combination with
<code><a href="../reference/compute_result.html">compute_result()</a></code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">get_sample</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">compute_result</span></span></code></pre></div>
<p>For convenience and auto-completion options in RStudio, we can store
the formats as <code>f</code>. A plain text format identifier like
<code>format="netCDF"</code> would do the same in the end.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="../reference/list_file_formats.html">list_file_formats</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_file</span> <span class="op">=</span> <span class="st">"test_get_sample.nc"</span></span>
<span><span class="va">obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_sample.html">get_sample</a></span><span class="op">(</span><span class="va">ndvi</span>, </span>
<span>                 as_stars<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                 output_file<span class="op">=</span><span class="va">sample_file</span>,</span>
<span>                 format <span class="op">=</span> <span class="va">f</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">netCDF</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/get_sample.html">get_sample()</a></code> function can be applied directly on an
intermediate processing step, without the need of explicitly defining a
<code>save_result</code> process. Internally either
<code>compute_result</code> (synchronous call) or
<code>create_job</code> (asynchronous call) is used, depending on the
parameter <code>execution='async'|'sync'</code>. For
<code>compute_result</code> several configurations can be passed to the
function using the <code>...</code> parameter. In that function the
automatic addition of <code>save_result</code> is handled. If no
specific format was specified, then ‘netCDF’ will be chosen as a
default, if the back-end support that format.</p>
<p>In the former example, there were two more interesting parameters. As
<code>format</code>, <code>output_file</code> is defined in
<code>compute_result</code> and allows to specify a path were to store
the sample data on your local machine. The parameter
<code>as_stars</code> controls whether or not the downloaded sample will
be opened as a <code>stars</code> object (requires package
<code>stars</code> to be installed).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span></span></code></pre></div>
<p>And as <code>obj</code> is already a <code>stars</code> object, we
now completely work on local sample data. You can now test and check the
sample data and potentially develop UDFs.</p>
<p>Hint: Newer versions of ‘stars’ already interpret the temporal
dimension into POSIX dates and the next code block can be skipped.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_get_dimension_values</a></span><span class="op">(</span><span class="va">obj</span>,<span class="st">"t"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_set_dimensions</a></span><span class="op">(</span><span class="va">obj</span>,which<span class="op">=</span><span class="st">"t"</span>,values <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html" class="external-link">geom_stars</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">obj</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, lets compare the bounding boxes of the original request with the
one of the obtained data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">received_data_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapview</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">initial_bbox</span>,<span class="va">received_data_bbox</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note: The bounding box of the obtained sample data is smaller than
the original one. It should be even smaller, <code><a href="../reference/get_sample.html">get_sample()</a></code>
takes the center point of the bounding box and fetches data in a 0.0003°
radius, which is approximately 30 meter in all directions. If the
bounding box coordinate reference is not in WGS84 (default EPSG:4326)
the package <code>sf</code> is required to handle the coordinate
transformations. As mentioned in the beginning the current realization
of the back-end provider has realized a serialization of a minimum tile
sizes of 256x256 pixel.</p>
</div>
<div class="section level2">
<h2 id="why-stars">Why <code>stars</code><a class="anchor" aria-label="anchor" href="#why-stars"></a>
</h2>
<p>The <code>stars</code> package was chosen to represent
multidimensional spatio-temporal data in this context, because that was
the exact developers intention. Also <code>stars</code> offer several
coercion functions to convert the data into formats of other packages
for a more specialized purpose like <code>terra</code> for raster
operations. Another reason is the planned use of <code>stars</code> in
the UDF module for R. With this in mind the user can obtain a
<code>stars</code> object and develop an R-UDF locally, which can
potentially run on the back-end.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Florian Lahn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
