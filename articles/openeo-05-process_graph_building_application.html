<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Process Graph Building Application • openeo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Process Graph Building Application">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openeo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/openeo-01-getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/openeo-02-sample_data.html">Sample Data Retrieval</a>
    </li>
    <li>
      <a href="../articles/openeo-03-package-software-architecture.html">Software and Package Architecture</a>
    </li>
    <li>
      <a href="../articles/openeo-04-process_graph_concepts.html">Process Graph Building</a>
    </li>
    <li>
      <a href="../articles/openeo-05-process_graph_building_application.html">Process Graph Building Application</a>
    </li>
    <li>
      <a href="../articles/openeo-06-developer_implementation_details.html">Developer Implementation Details</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Open-EO/openeo-r-client/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Process Graph Building Application</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Open-EO/openeo-r-client/blob/master/vignettes/openeo-05-process_graph_building_application.Rmd" class="external-link"><code>vignettes/openeo-05-process_graph_building_application.Rmd</code></a></small>
      <div class="hidden name"><code>openeo-05-process_graph_building_application.Rmd</code></div>

    </div>

    
    
<p>As the title suggests, we will describe in more detail how to create
process graphs and respectively “User Defined Processes” (UDP). Those
processes can be seen as the analysis workflows you want to run at the
openEO back-end of your choice. You might call them later directly or
you might add some variables to the UDP to customize the processes at
runtime, e.g. set the temporal interval or the area of interest. This
vignette focuses the user point of view.</p>
<div class="section level2">
<h2 id="evi-calculation-from-function">EVI calculation from function<a class="anchor" aria-label="anchor" href="#evi-calculation-from-function"></a>
</h2>
<p>In the following we will create the <a href="https://www.usgs.gov/landsat-missions/landsat-enhanced-vegetation-index" class="external-link">EVI
calculation</a> and store it as a process graph on the openEO
service.</p>
<p>Most of the processes offered by openEO services are standardized,
this means that it will be possible to use mathematical operators like
<code>+</code>, <code>-</code> and alike coherently between different
services. That also allowed us to overload the primitive mathematical
operators in R so that it becomes easy to use.</p>
<p>The EVI calculation is an function that is going to be applied on
specific bands in an optical image collection. It involves the bands
“red”, “blue” and the near infrared. This means that those 3 bands are
computed into a single band, which will be referred to as reducing the
band dimension. This calculation is a simple band arithmetic, which is
usually done in R by passing a function to a raster calculation function
like <code>raster::calc</code>. Similarly we use this mechanism in the
openeo package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-eo.github.io/openeo-r-client/" class="external-link">openeo</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'openeo'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     capabilities, debug</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/processes.html">processes</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">evi</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,<span class="va">context</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">B08</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">B04</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">B02</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">B08</span> <span class="op">-</span> <span class="va">B04</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">B08</span>, <span class="fl">6</span> <span class="op">*</span> <span class="va">B04</span>, <span class="op">-</span><span class="fl">7.5</span> <span class="op">*</span> <span class="va">B02</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Just to get an impression what happens behind the scenes, we will now
have a look at the JSON graph of this quite simple looking arithmetic
function. Under normal circumstances you would not need to deal with
creating the JSON representation by yourself, this will be handled
internally by the package.</p>
<p>The following coerce function will create an internal
<code>Graph</code> object and using its <code>print</code> function the
object is automatically serialized into the JSON graph.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">evi</span>,<span class="st">"Graph"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## {</span></span>
<span><span class="co">##   "array_element_MWLEF2607D": {</span></span>
<span><span class="co">##     "process_id": "array_element",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "data": {</span></span>
<span><span class="co">##         "from_parameter": "data"</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       "index": 0,</span></span>
<span><span class="co">##       "return_nodata": false</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "array_element_FIEEX4173B": {</span></span>
<span><span class="co">##     "process_id": "array_element",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "data": {</span></span>
<span><span class="co">##         "from_parameter": "data"</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       "index": 1,</span></span>
<span><span class="co">##       "return_nodata": false</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "subtract_FDPBC9286I": {</span></span>
<span><span class="co">##     "process_id": "subtract",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "x": {</span></span>
<span><span class="co">##         "from_node": "array_element_MWLEF2607D"</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       "y": {</span></span>
<span><span class="co">##         "from_node": "array_element_FIEEX4173B"</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "multiply_VJUBQ4276X": {</span></span>
<span><span class="co">##     "process_id": "multiply",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "x": 2.5,</span></span>
<span><span class="co">##       "y": {</span></span>
<span><span class="co">##         "from_node": "subtract_FDPBC9286I"</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "multiply_VAFBS6830A": {</span></span>
<span><span class="co">##     "process_id": "multiply",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "x": 6,</span></span>
<span><span class="co">##       "y": {</span></span>
<span><span class="co">##         "from_node": "array_element_FIEEX4173B"</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "array_element_WKKEU3372B": {</span></span>
<span><span class="co">##     "process_id": "array_element",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "data": {</span></span>
<span><span class="co">##         "from_parameter": "data"</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       "index": 2,</span></span>
<span><span class="co">##       "return_nodata": false</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "multiply_YOREH2784L": {</span></span>
<span><span class="co">##     "process_id": "multiply",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "x": -7.5,</span></span>
<span><span class="co">##       "y": {</span></span>
<span><span class="co">##         "from_node": "array_element_WKKEU3372B"</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "sum_SPKZC8322W": {</span></span>
<span><span class="co">##     "process_id": "sum",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "data": [</span></span>
<span><span class="co">##         {</span></span>
<span><span class="co">##           "from_node": "array_element_MWLEF2607D"</span></span>
<span><span class="co">##         },</span></span>
<span><span class="co">##         {</span></span>
<span><span class="co">##           "from_node": "multiply_VAFBS6830A"</span></span>
<span><span class="co">##         },</span></span>
<span><span class="co">##         {</span></span>
<span><span class="co">##           "from_node": "multiply_YOREH2784L"</span></span>
<span><span class="co">##         },</span></span>
<span><span class="co">##         1</span></span>
<span><span class="co">##       ],</span></span>
<span><span class="co">##       "ignore_nodata": false</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "divide_JCFDJ2625G": {</span></span>
<span><span class="co">##     "process_id": "divide",</span></span>
<span><span class="co">##     "arguments": {</span></span>
<span><span class="co">##       "x": {</span></span>
<span><span class="co">##         "from_node": "multiply_VJUBQ4276X"</span></span>
<span><span class="co">##       },</span></span>
<span><span class="co">##       "y": {</span></span>
<span><span class="co">##         "from_node": "sum_SPKZC8322W"</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     },</span></span>
<span><span class="co">##     "result": true</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>The coercion was just an excursion in order to get a glimpse at the
data structure that will be sent to the back-end. We now continue with
the user-defined process creation.</p>
</div>
<div class="section level2">
<h2 id="building-the-graph-for-data-manipulation">Building the graph for data manipulation<a class="anchor" aria-label="anchor" href="#building-the-graph-for-data-manipulation"></a>
</h2>
<p>The prior use case covered a sub process graph. Now, we are going to
create an analysis ready process graph that selects data, and makes
multiple dimension modification. It will use the EVI band arithmetic as
an inbound function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/processes.html">processes</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="fl">16.1</span>,</span>
<span>                 xmax<span class="op">=</span><span class="fl">16.6</span>,</span>
<span>                 ymax<span class="op">=</span><span class="fl">48.6</span>,</span>
<span>                 ymin<span class="op">=</span> <span class="fl">47.2</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">load_collection</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"SENTINEL2_L2A_SENTINELHUB"</span>,</span>
<span>                         spatial_extent <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>                         temporal_extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                           <span class="st">"2018-04-01"</span>, <span class="st">"2018-05-01"</span></span>
<span>                         <span class="op">)</span>,</span>
<span>                         bands<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B08"</span>,<span class="st">"B04"</span>,<span class="st">"B02"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we are using the EVI calculation at the variable
<code>evi</code> from example in the beginning.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spectral_reduce</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">reduce_dimension</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, dimension <span class="op">=</span> <span class="st">"bands"</span>,reducer <span class="op">=</span> <span class="va">evi</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temporal_reduce</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">reduce_dimension</span><span class="op">(</span>data<span class="op">=</span><span class="va">spectral_reduce</span>,dimension <span class="op">=</span> <span class="st">"t"</span>, reducer <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>As a “reducer” or “aggregator” function you will have to always
create an anonymous function or use a predefined one, with the same
amount of process graph parameters. The naming of parameters does not
matter, because simply the order matters. To know how to formulate the
function, you need to check the back-end processes documentation,
e.g. <code>process_viewer(p$reduce_dimension)</code> or
<code>describe_process(p$reduce_dimension)</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apply_linear_transform</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">apply</span><span class="op">(</span>data<span class="op">=</span><span class="va">temporal_reduce</span>,process <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">linear_scale_range</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, </span>
<span>                           inputMin <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, </span>
<span>                           inputMax <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                           outputMin <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                           outputMax <span class="op">=</span> <span class="fl">255</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>As a last step we will store the results as a PNG file. The
<code>ProcessNode</code> returned from that function will be our end
node in the graph and so we will pass it on towards openEO service
functions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">save_result</span><span class="op">(</span>data<span class="op">=</span><span class="va">apply_linear_transform</span>,format<span class="op">=</span><span class="st">"PNG"</span><span class="op">)</span></span></code></pre></div>
<p>The result might be considered as the final node in this graph. This
node we can pass to a processing function like
<code><a href="../reference/compute_result.html">compute_result()</a></code> or <code><a href="../reference/create_job.html">create_job()</a></code>. Or we store
the process at the back-end in order to be reused (Note: it depends on
whether a particular back-end supports the user-defined processes).</p>
<p>You don’t necessarily need to store each intermediate step in a
separate variable, but it might speed things up, when you want to edit
some parameters. This means you can write this graph also little tidy’er
like this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/processes.html">processes</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result2</span> <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="fu">load_collection</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"SENTINEL2_L2A_SENTINELHUB"</span>,</span>
<span>                         spatial_extent <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>                         temporal_extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                           <span class="st">"2018-04-01"</span>, <span class="st">"2018-05-01"</span></span>
<span>                         <span class="op">)</span>,</span>
<span>                         bands<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B08"</span>,<span class="st">"B04"</span>,<span class="st">"B02"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">reduce_dimension</span><span class="op">(</span>dimension <span class="op">=</span> <span class="st">"bands"</span>,reducer <span class="op">=</span> <span class="va">evi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">reduce_dimension</span><span class="op">(</span>dimension <span class="op">=</span> <span class="st">"t"</span>, reducer <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">apply</span><span class="op">(</span>process <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span><span class="op">$</span><span class="fu">linear_scale_range</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, </span>
<span>                             inputMin <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, </span>
<span>                             inputMax <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                             outputMin <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                             outputMax <span class="op">=</span> <span class="fl">255</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">p</span><span class="op">$</span><span class="fu">save_result</span><span class="op">(</span>format<span class="op">=</span><span class="st">"PNG"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="user-defined-processes">User-defined processes<a class="anchor" aria-label="anchor" href="#user-defined-processes"></a>
</h2>
<p>So, now we have created a small evi graph and one carrying out the
whole processing on the data. In the next steps we store it for later
use at the openEO service. The next section depends on the features
supported by the connected back-end and might not be present. In any
case the next functions showcase the intended use of the user-defined
processes. In short, user-defined processes allow you to store your
process graphs as reuseable processes on the back-end in the same way
predefined-processes exists as the basic graph building blocks. However,
the same functionality you already have with the fact, that you can
write R scripts and let the code run again, this is the reasoning for
back-end provider that don’t support user-defined processes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_user_processes.html">list_user_processes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>With the next command you can check your process graph locally for
potential problems, before even sending it to the back-end.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validate_process.html">validate_process</a></span><span class="op">(</span>graph <span class="op">=</span> <span class="va">evi</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="udp-evi-band-aritmethic">UDP: EVI band aritmethic<a class="anchor" aria-label="anchor" href="#udp-evi-band-aritmethic"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_id</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_user_process.html">create_user_process</a></span><span class="op">(</span>graph <span class="op">=</span> <span class="va">evi</span>, id <span class="op">=</span> <span class="st">"evi"</span>, summary <span class="op">=</span> <span class="st">"EVI calculation on an array with 3 bands"</span>, description <span class="op">=</span> <span class="st">"The EVI calculation is based on an array of 3 band values: blue, red, nir. In that order."</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_user_processes.html">list_user_processes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Fetch the process graph definition as a user define openEO process
and print it.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evi_process</span> <span class="op">=</span> <span class="fu"><a href="../reference/describe_user_process.html">describe_user_process</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"evi"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">evi_process</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evi_process</span></span></code></pre></div>
<p>If you want the graph representation reimported into R, you can use
<code>parse_graph</code> on this received <code>ProcessInfo</code>
object or you can use the coerce function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evi_graph</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_graph.html">parse_graph</a></span><span class="op">(</span>json <span class="op">=</span> <span class="va">evi_process</span><span class="op">)</span> <span class="co"># or use as(evi_process,"Graph")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="udp-minimum-evi">UDP: Minimum EVI<a class="anchor" aria-label="anchor" href="#udp-minimum-evi"></a>
</h3>
<p>Note: depending on the supported back-end functionalities storing
user-defined processes might not be implemented. But the following code
sample shows, how you would create a user-defined processes on the
back-end.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_evi_graph_id</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_user_process.html">create_user_process</a></span><span class="op">(</span> graph <span class="op">=</span> <span class="va">result</span>, id <span class="op">=</span> <span class="st">"min_evi"</span>,summary<span class="op">=</span><span class="st">"Minimum EVI calculation on Sentinel-2"</span>, description <span class="op">=</span> <span class="st">"A preset process graph that will calculate the minimum NDVI on Sentinel-2 data, performs a linear scale into the value interval 0 to 255 in order to store the results as PNG."</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_user_processes.html">list_user_processes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>As this graph has no parameters and will simply run like a
pre-configured job, feel free to delete the example process again.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/delete_user_process.html">delete_user_process</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">min_evi_graph_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integration-of-user-defined-processes">Integration of user defined processes<a class="anchor" aria-label="anchor" href="#integration-of-user-defined-processes"></a>
</h3>
<p>As we have eventually created a user-defined process for the
<code>evi</code> function. The openeo package allows you to reuse this
processes in a similar way as predefined processes. Instead of
<code><a href="../reference/processes.html">processes()</a></code>, you can also use <code><a href="../reference/user_processes.html">user_processes()</a></code>
to create a process node builder object. We named the process also
<code>evi</code> which helps to reference to the correct processes. We
will now use the the complete workflow, where we have stored the
intermediate nodes in individual variables. We will then edit the
parameter that holds the <code>evi</code> function and replace the
function with the user-defined process <code>evi</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/processes.html">processes</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">udps</span> <span class="op">=</span> <span class="fu"><a href="../reference/user_processes.html">user_processes</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spectral_reduce</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">reducer</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">context</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">udps</span><span class="op">$</span><span class="fu">evi</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">min_evi_graph</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">result</span>,<span class="st">"Process"</span><span class="op">)</span></span></code></pre></div>
<p>As all the process nodes and arguments are R6 classes, the value is
replaced at object level. The R6 object is uniquely referable which
means that the value is updated wherever the process node was used.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Florian Lahn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
